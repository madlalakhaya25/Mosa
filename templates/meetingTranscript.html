<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transcript View</title>
    <!-- Bootstrap CSS for consistency -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

    <style>
        /* Custom CSS for enhanced appearance */
        body {
            background-color: #f8f9fa; /* Match dashboard background color */
            font-family: Arial, sans-serif; /* Use a more common font */
        }
        .navbar {
            background-color: #38a8de; /* Match dashboard navigation bar color */
        }
        .navbar-brand img {
            margin-right: 10px;
            vertical-align: middle;
        }
        .transcript-container {
            background-color: #fff;
            border: 1px solid #ddd;
            padding: 20px;
            margin-top: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Add shadow for depth */
        }
        .transcript-entry {
            position: relative; /* Add relative positioning for highlighting/annotation */
        }
        .speaker {
            font-weight: bold;
            color: #007bff; /* Blue color for speaker name */
        }
        .timestamp {
            color: #6c757d;
            margin-left: 10px;
        }
        .transcript-text {
            margin-top: 5px;
        }
        .note-input {
            margin-top: 20px;
        }
        .search-transcript {
            margin-top: 20px;
        }
        .download-print {
            margin-top: 20px;
        }
        .highlight {
            background-color: #fff3cd; /* Yellow background for highlighted text */
            padding: 2px 4px; /* Add padding to highlight */
            border-radius: 3px; /* Add rounded corners */
        }
        .annotate-btn {
            position: absolute;
            top: 5px;
            right: 10px;
        }

        /* Button basic styles */
.btn {
  display: inline-block;
  padding: 0.5em 1em;
  margin: 0.5em;
  border: none;
  border-radius: 0.3em;
  background-color: #17a2b8; /* Bootstrap info color */
  color: white;
  font-size: 1em;
  cursor: pointer;
  text-align: center;
  text-decoration: none;
  transition: background-color 0.3s ease;
}

/* Button block styles for full width */
.btn-block {
  display: block;
  width: 100%;
}

/* Hover and focus styles */
.btn:hover, .btn:focus {
  background-color: #138496; /* A darker shade for hover state */
}

/* Active styles */
.btn:active {
  background-color: #117a8b; /* Even darker shade for active state */
}

/* Disabled styles */
.btn:disabled {
  background-color: #d1ecf1; /* Lighter shade for disabled state */
  color: #7b8a8b; /* Gray text for disabled state */
  cursor: not-allowed;
}

    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="container">
        
        <!-- Navigation Bar -->
        <nav class="navbar navbar-expand-lg navbar-light">
            <div class="container-fluid">
                <a class="navbar-brand" href="/dashboard">
                    <img src="{{ url_for('static', filename='css/BOTLHALE.png') }}" alt="Logo" width="30" height="24">
                    Back to Dashboard
                </a>
            </div>
        </nav>


        <!-- Main Content Area for Transcript -->
        <div class="transcript-container">
            <h2 class="mb-4">Meeting Transcript</h2>
            <!-- Example Transcript Entry -->
            {% for meeting in transcriptList %}
            <div class="meeting-transcript">
                <h3>{{ meeting.meeting_name }}</h3>
                {% for entry in meeting.transcript %}
                <div class="transcript-entry">
                    <span class="speaker">{{ entry.speaker }}:</span>
                    <span class="timestamp">[{{ entry.start_time }}]</span>
                    <p class="transcript-text">{{ entry.transcription }}</p>
                </div>
                {% endfor %}
            </div>
            {% endfor %}
            <!-- Repeat for each entry -->

            <!-- Toggle Timestamps Button -->
            <button class="btn btn-primary toggle-timestamps mb-3">Toggle Timestamps</button>

            

            

            <!-- Download and Print Options -->
            <div class="download-print mt-4">
                <h4>Download & Print</h4>
                <div class="row">
                    <div class="col">
                        <button type="button" class="btn btn-info btn-block" onclick="savePDF()">Download PDF</button>
                    </div>
                    <div class="col">
                        <button type="button" class="btn btn-info btn-block" onclick="saveText()">Download Text</button>
                    </div>
                    <div class="col">
                        <button type="button" class="btn btn-info btn-block" onclick="printTranscript()">Print Transcript</button>
                    </div>
                </div>
            </div>
            

    <!-- Bootstrap JS for functionality -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/vfs_fonts.js"></script>

    <script>

function saveText() {
            // Retrieve transcript text
            var transcriptText = "";
            var transcriptEntries = document.querySelectorAll('.transcript-entry');
            transcriptEntries.forEach(function (entry) {
                transcriptText += entry.querySelector('.speaker').innerText + ' ' + entry.querySelector('.timestamp').innerText + ': ' + entry.querySelector('.transcript-text').innerText + '\n';
            });
            
            // Create a Blob containing the text
            var blob = new Blob([transcriptText], { type: 'text/plain' });

            // Create a temporary link element
            var link = document.createElement('a');
            link.href = window.URL.createObjectURL(blob);
            link.download = 'meeting_transcript.txt';

            // Append the link to the body
            document.body.appendChild(link);

            // Trigger the download
            link.click();

            // Clean up
            document.body.removeChild(link);
        }


function savePDF() {
    // Define the document definition for pdfmake
    var docDefinition = {
        content: []
    };

    // Retrieve transcript entries
    var transcriptEntries = document.querySelectorAll('.transcript-entry');
    transcriptEntries.forEach(function (entry) {
        var speaker = entry.querySelector('.speaker').innerText;
        var timestamp = entry.querySelector('.timestamp').innerText;
        var text = entry.querySelector('.transcript-text').innerText;
        
        // Add entry to the document definition
        docDefinition.content.push({ text: `${speaker} ${timestamp}: ${text}`, margin: [0, 0, 0, 10] });
    });

    // Generate PDF from the document definition and trigger download
    pdfMake.createPdf(docDefinition).download('meeting_transcript.pdf');
}

        function printTranscript() {
    window.print();
}

        $(document).ready(function() {
            // Toggle Timestamps Functionality
            $('.toggle-timestamps').on('click', function() {
                $('.timestamp').toggle();
            });
            
        });
    </script>
</body>
</html>
